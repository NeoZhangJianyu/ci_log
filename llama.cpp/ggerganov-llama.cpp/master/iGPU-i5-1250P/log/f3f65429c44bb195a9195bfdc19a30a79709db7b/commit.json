{"author": "Georgi Gerganov <ggerganov@gmail.com>", "date": "2024-06-26 18:33:02", "title": "llama : reorganize source code + improve CMake", "pr_id": "8006", "files": [".devops/nix/package.nix", ".github/labeler.yml", ".github/workflows/bench.yml", ".github/workflows/build.yml", ".github/workflows/server.yml", ".gitignore", ".gitmodules", "CMakeLists.txt", "CMakePresets.json", "Makefile", "Package.swift", "README-sycl.md", "README.md", "ci/run.sh", "cmake/build-info.cmake", "cmake/git-vars.cmake", "cmake/llama-config.cmake.in", "common/CMakeLists.txt", "common/cmake/build-info-gen-cpp.cmake", "docs/BLIS.md", "examples/CMakeLists.txt", "examples/imatrix/README.md", "examples/llava/MobileVLM-README.md", "examples/rpc/README.md", "examples/server/CMakeLists.txt", "examples/sycl/build.sh", "examples/sycl/win-build-sycl.bat", "ggml/CMakeLists.txt", "ggml/cmake/FindSIMD.cmake", "ggml/ggml_vk_generate_shaders.py", "ggml/include/ggml-alloc.h", "ggml/include/ggml-backend.h", "ggml/include/ggml-blas.h", "ggml/include/ggml-cuda.h", "ggml/include/ggml-kompute.h", "ggml/include/ggml-metal.h", "ggml/include/ggml-rpc.h", "ggml/include/ggml-sycl.h", "ggml/include/ggml-vulkan.h", "ggml/include/ggml.h", "ggml/src/CMakeLists.txt", "ggml/src/ggml-alloc.c", "ggml/src/ggml-backend-impl.h", "ggml/src/ggml-backend.c", "ggml/src/ggml-blas.cpp", "ggml/src/ggml-common.h", "ggml/src/ggml-cuda.cu", "ggml/src/ggml-cuda/acc.cu", "ggml/src/ggml-cuda/acc.cuh", "ggml/src/ggml-cuda/arange.cu", "ggml/src/ggml-cuda/arange.cuh", "ggml/src/ggml-cuda/argsort.cu", "ggml/src/ggml-cuda/argsort.cuh", "ggml/src/ggml-cuda/binbcast.cu", "ggml/src/ggml-cuda/binbcast.cuh", "ggml/src/ggml-cuda/clamp.cu", "ggml/src/ggml-cuda/clamp.cuh", "ggml/src/ggml-cuda/common.cuh", "ggml/src/ggml-cuda/concat.cu", "ggml/src/ggml-cuda/concat.cuh", "ggml/src/ggml-cuda/convert.cu", "ggml/src/ggml-cuda/convert.cuh", "ggml/src/ggml-cuda/cpy.cu", "ggml/src/ggml-cuda/cpy.cuh", "ggml/src/ggml-cuda/dequantize.cuh", "ggml/src/ggml-cuda/diagmask.cu", "ggml/src/ggml-cuda/diagmask.cuh", "ggml/src/ggml-cuda/dmmv.cu", "ggml/src/ggml-cuda/dmmv.cuh", "ggml/src/ggml-cuda/fattn-common.cuh", "ggml/src/ggml-cuda/fattn-tile-f16.cu", "ggml/src/ggml-cuda/fattn-tile-f16.cuh", "ggml/src/ggml-cuda/fattn-tile-f32.cu", "ggml/src/ggml-cuda/fattn-tile-f32.cuh", "ggml/src/ggml-cuda/fattn-vec-f16.cuh", "ggml/src/ggml-cuda/fattn-vec-f32.cuh", "ggml/src/ggml-cuda/fattn-wmma-f16.cuh", "ggml/src/ggml-cuda/fattn.cu", "ggml/src/ggml-cuda/fattn.cuh", "ggml/src/ggml-cuda/getrows.cu", "ggml/src/ggml-cuda/getrows.cuh", "ggml/src/ggml-cuda/im2col.cu", "ggml/src/ggml-cuda/im2col.cuh", "ggml/src/ggml-cuda/mma.cuh", "ggml/src/ggml-cuda/mmq.cu", "ggml/src/ggml-cuda/mmq.cuh", "ggml/src/ggml-cuda/mmvq.cu", "ggml/src/ggml-cuda/mmvq.cuh", "ggml/src/ggml-cuda/norm.cu", "ggml/src/ggml-cuda/norm.cuh", "ggml/src/ggml-cuda/pad.cu", "ggml/src/ggml-cuda/pad.cuh", "ggml/src/ggml-cuda/pool2d.cu", "ggml/src/ggml-cuda/pool2d.cuh", "ggml/src/ggml-cuda/quantize.cu", "ggml/src/ggml-cuda/quantize.cuh", "ggml/src/ggml-cuda/rope.cu", "ggml/src/ggml-cuda/rope.cuh", "ggml/src/ggml-cuda/scale.cu", "ggml/src/ggml-cuda/scale.cuh", "ggml/src/ggml-cuda/softmax.cu", "ggml/src/ggml-cuda/softmax.cuh", "ggml/src/ggml-cuda/sumrows.cu", "ggml/src/ggml-cuda/sumrows.cuh", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-f16-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-f16-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-f16-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-f16-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-f16-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-f16-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q4_0-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q4_0-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q4_0-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q4_0-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q4_0-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q4_0-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q4_1-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q4_1-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q4_1-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q4_1-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q4_1-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q4_1-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q5_0-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q5_0-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q5_0-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q5_0-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q5_0-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q5_0-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q5_1-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q5_1-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q5_1-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q5_1-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q5_1-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q5_1-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q8_0-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q8_0-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q8_0-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q8_0-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q8_0-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs128-q8_0-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs256-f16-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs64-f16-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs64-f16-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs64-f16-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs64-f16-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs64-f16-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f16-instance-hs64-f16-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-f16-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-f16-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-f16-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-f16-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-f16-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-f16-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q4_0-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q4_0-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q4_0-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q4_0-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q4_0-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q4_0-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q4_1-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q4_1-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q4_1-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q4_1-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q4_1-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q4_1-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q5_0-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q5_0-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q5_0-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q5_0-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q5_0-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q5_0-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q5_1-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q5_1-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q5_1-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q5_1-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q5_1-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q5_1-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q8_0-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q8_0-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q8_0-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q8_0-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q8_0-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs128-q8_0-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs256-f16-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs64-f16-f16.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs64-f16-q4_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs64-f16-q4_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs64-f16-q5_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs64-f16-q5_1.cu", "ggml/src/ggml-cuda/template-instances/fattn-vec-f32-instance-hs64-f16-q8_0.cu", "ggml/src/ggml-cuda/template-instances/fattn-wmma-f16-instance-kqfloat-cpb16.cu", "ggml/src/ggml-cuda/template-instances/fattn-wmma-f16-instance-kqfloat-cpb32.cu", "ggml/src/ggml-cuda/template-instances/fattn-wmma-f16-instance-kqhalf-cpb16.cu", "ggml/src/ggml-cuda/template-instances/fattn-wmma-f16-instance-kqhalf-cpb32.cu", "ggml/src/ggml-cuda/template-instances/fattn-wmma-f16-instance-kqhalf-cpb8.cu", "ggml/src/ggml-cuda/template-instances/generate_cu_files.py", "ggml/src/ggml-cuda/template-instances/mmq-instance-q2_k.cu", "ggml/src/ggml-cuda/template-instances/mmq-instance-q3_k.cu", "ggml/src/ggml-cuda/template-instances/mmq-instance-q4_0.cu", "ggml/src/ggml-cuda/template-instances/mmq-instance-q4_1.cu", "ggml/src/ggml-cuda/template-instances/mmq-instance-q4_k.cu", "ggml/src/ggml-cuda/template-instances/mmq-instance-q5_0.cu", "ggml/src/ggml-cuda/template-instances/mmq-instance-q5_1.cu", "ggml/src/ggml-cuda/template-instances/mmq-instance-q5_k.cu", "ggml/src/ggml-cuda/template-instances/mmq-instance-q6_k.cu", "ggml/src/ggml-cuda/template-instances/mmq-instance-q8_0.cu", "ggml/src/ggml-cuda/tsembd.cu", "ggml/src/ggml-cuda/tsembd.cuh", "ggml/src/ggml-cuda/unary.cu", "ggml/src/ggml-cuda/unary.cuh", "ggml/src/ggml-cuda/upscale.cu", "ggml/src/ggml-cuda/upscale.cuh", "ggml/src/ggml-cuda/vecdotq.cuh", "ggml/src/ggml-impl.h", "ggml/src/ggml-kompute.cpp", "ggml/src/ggml-metal.m", "ggml/src/ggml-metal.metal", "ggml/src/ggml-quants.c", "ggml/src/ggml-quants.h", "ggml/src/ggml-rpc.cpp", "ggml/src/ggml-sycl.cpp", "ggml/src/ggml-sycl/backend.hpp", "ggml/src/ggml-sycl/common.cpp", "ggml/src/ggml-sycl/common.hpp", "ggml/src/ggml-sycl/convert.cpp", "ggml/src/ggml-sycl/convert.hpp", "ggml/src/ggml-sycl/dequantize.hpp", "ggml/src/ggml-sycl/dmmv.cpp", "ggml/src/ggml-sycl/dmmv.hpp", "ggml/src/ggml-sycl/dpct/helper.hpp", "ggml/src/ggml-sycl/mmq.cpp", "ggml/src/ggml-sycl/mmq.hpp", "ggml/src/ggml-sycl/mmvq.cpp", "ggml/src/ggml-sycl/mmvq.hpp", "ggml/src/ggml-sycl/presets.hpp", "ggml/src/ggml-sycl/vecdotq.hpp", "ggml/src/ggml-vulkan-shaders.hpp", "ggml/src/ggml-vulkan.cpp", "ggml/src/ggml.c", "ggml/src/kompute", "ggml/src/kompute-shaders/common.comp", "ggml/src/kompute-shaders/op_add.comp", "ggml/src/kompute-shaders/op_addrow.comp", "ggml/src/kompute-shaders/op_cpy_f16_f16.comp", "ggml/src/kompute-shaders/op_cpy_f16_f32.comp", "ggml/src/kompute-shaders/op_cpy_f32_f16.comp", "ggml/src/kompute-shaders/op_cpy_f32_f32.comp", "ggml/src/kompute-shaders/op_diagmask.comp", "ggml/src/kompute-shaders/op_gelu.comp", "ggml/src/kompute-shaders/op_getrows.comp", "ggml/src/kompute-shaders/op_getrows_f16.comp", "ggml/src/kompute-shaders/op_getrows_f32.comp", "ggml/src/kompute-shaders/op_getrows_q4_0.comp", "ggml/src/kompute-shaders/op_getrows_q4_1.comp", "ggml/src/kompute-shaders/op_getrows_q6_k.comp", "ggml/src/kompute-shaders/op_mul.comp", "ggml/src/kompute-shaders/op_mul_mat_f16.comp", "ggml/src/kompute-shaders/op_mul_mat_mat_f32.comp", "ggml/src/kompute-shaders/op_mul_mat_q4_0.comp", "ggml/src/kompute-shaders/op_mul_mat_q4_1.comp", "ggml/src/kompute-shaders/op_mul_mat_q6_k.comp", "ggml/src/kompute-shaders/op_mul_mat_q8_0.comp", "ggml/src/kompute-shaders/op_mul_mv_q_n.comp", "ggml/src/kompute-shaders/op_mul_mv_q_n_pre.comp", "ggml/src/kompute-shaders/op_norm.comp", "ggml/src/kompute-shaders/op_relu.comp", "ggml/src/kompute-shaders/op_rmsnorm.comp", "ggml/src/kompute-shaders/op_rope_f16.comp", "ggml/src/kompute-shaders/op_rope_f32.comp", "ggml/src/kompute-shaders/op_scale.comp", "ggml/src/kompute-shaders/op_scale_8.comp", "ggml/src/kompute-shaders/op_silu.comp", "ggml/src/kompute-shaders/op_softmax.comp", "ggml/src/kompute-shaders/rope_common.comp", "ggml/src/sgemm.cpp", "ggml/src/sgemm.h", "ggml/src/vulkan-shaders/add.comp", "ggml/src/vulkan-shaders/argsort.comp", "ggml/src/vulkan-shaders/clamp.comp", "ggml/src/vulkan-shaders/copy.comp", "ggml/src/vulkan-shaders/dequant_f32.comp", "ggml/src/vulkan-shaders/dequant_funcs.comp", "ggml/src/vulkan-shaders/dequant_head.comp", "ggml/src/vulkan-shaders/dequant_q2_k.comp", "ggml/src/vulkan-shaders/dequant_q3_k.comp", "ggml/src/vulkan-shaders/dequant_q4_0.comp", "ggml/src/vulkan-shaders/dequant_q4_1.comp", "ggml/src/vulkan-shaders/dequant_q4_k.comp", "ggml/src/vulkan-shaders/dequant_q5_0.comp", "ggml/src/vulkan-shaders/dequant_q5_1.comp", "ggml/src/vulkan-shaders/dequant_q5_k.comp", "ggml/src/vulkan-shaders/dequant_q6_k.comp", "ggml/src/vulkan-shaders/dequant_q8_0.comp", "ggml/src/vulkan-shaders/diag_mask_inf.comp", "ggml/src/vulkan-shaders/div.comp", "ggml/src/vulkan-shaders/gelu.comp", "ggml/src/vulkan-shaders/generic_binary_head.comp", "ggml/src/vulkan-shaders/generic_head.comp", "ggml/src/vulkan-shaders/generic_unary_head.comp", "ggml/src/vulkan-shaders/get_rows.comp", "ggml/src/vulkan-shaders/get_rows_quant.comp", "ggml/src/vulkan-shaders/mul.comp", "ggml/src/vulkan-shaders/mul_mat_split_k_reduce.comp", "ggml/src/vulkan-shaders/mul_mat_vec.comp", "ggml/src/vulkan-shaders/mul_mat_vec_base.comp", "ggml/src/vulkan-shaders/mul_mat_vec_nc.comp", "ggml/src/vulkan-shaders/mul_mat_vec_p021.comp", "ggml/src/vulkan-shaders/mul_mat_vec_q2_k.comp", "ggml/src/vulkan-shaders/mul_mat_vec_q3_k.comp", "ggml/src/vulkan-shaders/mul_mat_vec_q4_k.comp", "ggml/src/vulkan-shaders/mul_mat_vec_q5_k.comp", "ggml/src/vulkan-shaders/mul_mat_vec_q6_k.comp", "ggml/src/vulkan-shaders/mul_mm.comp", "ggml/src/vulkan-shaders/norm.comp", "ggml/src/vulkan-shaders/relu.comp", "ggml/src/vulkan-shaders/rms_norm.comp", "ggml/src/vulkan-shaders/rope_head.comp", "ggml/src/vulkan-shaders/rope_neox.comp", "ggml/src/vulkan-shaders/rope_norm.comp", "ggml/src/vulkan-shaders/scale.comp", "ggml/src/vulkan-shaders/silu.comp", "ggml/src/vulkan-shaders/soft_max.comp", "ggml/src/vulkan-shaders/square.comp", "ggml/src/vulkan-shaders/sum_rows.comp", "ggml/src/vulkan-shaders/types.comp", "include/llama.h", "scripts/build-info.sh", "scripts/compare-commits.sh", "scripts/debug-test.sh", "scripts/pod-llama.sh", "scripts/server-llm.sh", "scripts/sync-ggml-am.sh", "scripts/sync-ggml.sh", "spm-headers/ggml-alloc.h", "spm-headers/ggml-backend.h", "spm-headers/ggml-metal.h", "spm-headers/ggml.h", "spm-headers/llama.h", "src/CMakeLists.txt", "src/llama.cpp", "src/unicode-data.cpp", "src/unicode-data.h", "src/unicode.cpp", "src/unicode.h", "tests/test-backend-ops.cpp"]}